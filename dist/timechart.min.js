var TimeChart=function(t,e,n,i){"use strict";var s;function o(e){const n=t.rgb(e);return[n.r/255,n.g/255,n.b/255,n.opacity]}!function(t){t[t.Line=0]="Line",t[t.Step=1]="Step",t[t.NativeLine=2]="NativeLine",t[t.NativePoint=3]="NativePoint"}(s||(s={}));class a{constructor(t,e,n){this.options=e;const i=document.createElement("canvas"),s=i.style;s.position="absolute",s.width=s.height="100%",s.left=s.right=s.top=s.bottom="0",t.shadowRoot.appendChild(i),this.gl=function(t){const e=t.getContext("webgl2");if(!e)throw new Error("Unable to initialize WebGL2. Your browser or machine may not support it.");return e}(i);const a=o(e.backgroundColor);this.gl.clearColor(...a),this.canvas=i,n.updated.on((()=>{this.clear(),this.syncViewport()})),n.resized.on(((t,e)=>this.onResize(t,e))),n.disposing.on((()=>{t.shadowRoot.removeChild(i),i.width=0,i.height=0;const e=this.gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}))}syncViewport(){const t=this.options,e=t.pixelRatio;this.gl.viewport(t.renderPaddingLeft*e,t.renderPaddingBottom*e,this.canvas.width-(t.renderPaddingLeft+t.renderPaddingRight)*e,this.canvas.height-(t.renderPaddingTop+t.renderPaddingBottom)*e)}onResize(t,e){const n=this.canvas,i=this.options.pixelRatio;n.width=t*i,n.height=e*i,this.syncViewport()}clear(){const t=this.gl;t.clear(t.COLOR_BUFFER_BIT)}}class r{constructor(t,e,n){this.node=document.createElement("div"),this.node.style.position="absolute",this.node.style.left=`${n.paddingLeft}px`,this.node.style.right=`${n.paddingRight}px`,this.node.style.top=`${n.paddingTop}px`,this.node.style.bottom=`${n.paddingBottom}px`,t.shadowRoot.appendChild(this.node),e.disposing.on((()=>{t.shadowRoot.removeChild(this.node)}))}}function h(t,e,n,i,s){if(e>=n)return e;if(i<=s(t[e]))return e;if(i>s(t[n-1]))return n;for(n-=1;e+1<n;){const o=s(t[e]),a=s(t[n]),r=a<=o?0:(i-o)/(a-o);let h=Math.ceil(e+r*(n-e));h===n?h--:h===e&&h++;s(t[h])<i?e=h:n=h}return n}class d{constructor(){this.callbacks=[]}on(t){this.callbacks.push(t)}dispatch(...t){for(const e of this.callbacks)e(...t)}}class l{constructor(t,e,n,i){this.canvas=t,this.model=e,this.options=n,this.dataPoints=new Map,this.lastPointerPos=null,this.updated=new d,i.node.addEventListener("mousemove",(e=>{const n=t.canvas.getBoundingClientRect();this.lastPointerPos={x:e.clientX-n.left,y:e.clientY-n.top},this.adjustPoints()})),i.node.addEventListener("mouseleave",(t=>{this.lastPointerPos=null,this.adjustPoints()})),e.updated.on((()=>this.adjustPoints()))}adjustPoints(){if(null===this.lastPointerPos)this.dataPoints.clear();else{const t=this.model.xScale.invert(this.lastPointerPos.x);for(const e of this.options.series){if(0==e.data.length||!e.visible){this.dataPoints.delete(e);continue}const n=h(e.data,0,e.data.length,t,(t=>t.x)),i=[];n>0&&i.push(e.data[n-1]),n<e.data.length&&i.push(e.data[n]);const s=e=>Math.abs(e.x-t);i.sort(((t,e)=>s(t)-s(e)));const o=this.model.pxPoint(i[0]),a=this.canvas.canvas.clientWidth,r=this.canvas.canvas.clientHeight;o.x<=a&&o.x>=0&&o.y<=r&&o.y>=0?this.dataPoints.set(e,i[0]):this.dataPoints.delete(e)}}this.updated.dispatch()}}function c(t,e,n){let i=-1/0,s=1/0;for(let o=e;o<n;o++){const e=t[o].y;e>i&&(i=e),e<s&&(s=e)}return{max:i,min:s}}class p{constructor(t){this.options=t,this.xScale=e.scaleLinear(),this.yScale=e.scaleLinear(),this.xRange=null,this.yRange=null,this.resized=new d,this.updated=new d,this.disposing=new d,this.abortController=new AbortController,this.redrawRequested=!1,"auto"!==t.xRange&&t.xRange&&this.xScale.domain([t.xRange.min,t.xRange.max]),"auto"!==t.yRange&&t.yRange&&this.yScale.domain([t.yRange.min,t.yRange.max])}resize(t,e){const n=this.options;this.xScale.range([n.paddingLeft,t-n.paddingRight]),this.yScale.range([e-n.paddingBottom,n.paddingTop]),this.resized.dispatch(t,e),this.requestRedraw()}dispose(){this.abortController.signal.aborted||(this.abortController.abort(),this.disposing.dispatch())}update(){this.updateModel(),this.updated.dispatch();for(const t of this.options.series)t.data._synced()}updateModel(){const t=this.options.series.filter((t=>t.data.length>0));if(0===t.length)return;const e=this.options;{const n=Math.max(...t.map((t=>t.data[t.data.length-1].x))),i=Math.min(...t.map((t=>t.data[0].x)));if(this.xRange={max:n,min:i},this.options.realTime||"auto"===e.xRange)if(this.options.realTime){const t=this.xScale.domain(),e=t[1]-t[0];this.xScale.domain([n-e,n])}else this.xScale.domain([i,n]);else e.xRange&&this.xScale.domain([e.xRange.min,e.xRange.max])}{const n=t.flatMap((t=>[c(t.data,0,t.data.pushed_front),c(t.data,t.data.length-t.data.pushed_back,t.data.length)]));this.yRange&&n.push(this.yRange),this.yRange=function(...t){return{min:Math.min(...t.map((t=>t.min))),max:Math.max(...t.map((t=>t.max)))}}(...n),"auto"===e.yRange?this.yScale.domain([this.yRange.min,this.yRange.max]).nice():e.yRange&&this.yScale.domain([e.yRange.min,e.yRange.max])}}requestRedraw(){if(this.redrawRequested)return;this.redrawRequested=!0;const t=this.abortController.signal;requestAnimationFrame((e=>{this.redrawRequested=!1,t.aborted||this.update()}))}pxPoint(t){return{x:this.xScale(t.x),y:this.yScale(t.y)}}}class u{constructor(t,e){this.svgNode=document.createElementNS("http://www.w3.org/2000/svg","svg");const n=this.svgNode.style;n.position="absolute",n.width=n.height="100%",n.left=n.right=n.top=n.bottom="0",t.shadowRoot.appendChild(this.svgNode),e.disposing.on((()=>{t.shadowRoot.removeChild(this.svgNode)}))}}class m extends Array{constructor(){super(...arguments),this.pushed_back=0,this.pushed_front=0,this.poped_back=0,this.poped_front=0,this.pushed_back=this.length}_synced(){this.pushed_back=this.poped_back=this.pushed_front=this.poped_front=0}static _from_array(t){if(t instanceof m)return t;const e=Object.setPrototypeOf(t,m.prototype);return e.poped_back=e.pushed_front=e.poped_front=0,e.pushed_back=e.length,e}push(...t){return this.pushed_back+=t.length,super.push(...t)}pop(){const t=this.length,e=super.pop();return void 0===e||(this.pushed_back>0?this.pushed_back--:t-this.pushed_front>0?this.poped_back++:this.pushed_front--),e}unshift(...t){return this.pushed_front+=t.length,super.unshift(...t)}shift(){const t=this.length,e=super.shift();return void 0===e||(this.pushed_front>0?this.pushed_front--:t-this.pushed_back>0?this.poped_front++:this.pushed_back--),e}updateDelete(t,e,n){if(0===e)return;const i=t=>(n-=t,0===(e-=t));if(t<this.pushed_front){const n=Math.min(e,this.pushed_front-t);if(this.pushed_front-=n,i(n))return}if(t===this.pushed_front){const t=Math.min(e,n-this.pushed_front-this.pushed_back);if(this.poped_front+=t,i(t))return}if(t>this.pushed_front&&t<n-this.pushed_back){if(t+e<n-this.pushed_back)throw new RangeError("DataPoints that already synced to GPU cannot be delete in the middle");const s=Math.min(e,n-t-this.pushed_back);if(this.poped_back+=s,i(s))return}const s=Math.min(e,n-t);if(this.pushed_back-=s,!i(s))throw new Error("BUG")}updateInsert(t,e,n){if(t<=this.pushed_front)this.pushed_front+=e;else{if(!(t>=n-this.pushed_back))throw new RangeError("DataPoints cannot be inserted in the middle of the range that is already synced to GPU");this.pushed_back+=e}}splice(t,e,...n){t===-1/0?t=0:t<0&&(t=Math.max(this.length+t,0)),e=void 0===e?this.length-t:Math.min(Math.max(e,0),this.length-t),this.updateDelete(t,e,this.length),this.updateInsert(t,n.length,this.length-e);const i=this.length-e+n.length,s=super.splice(t,e,...n);if(this.length!==i)throw new Error(`BUG! length after splice not expected. ${this.length} vs ${i}`);return s}}const g={pixelRatio:window.devicePixelRatio,lineWidth:1,backgroundColor:t.rgb(0,0,0,0),paddingTop:10,paddingRight:10,paddingLeft:45,paddingBottom:20,renderPaddingTop:0,renderPaddingRight:0,renderPaddingLeft:0,renderPaddingBottom:0,xRange:"auto",yRange:"auto",realTime:!1,baseTime:0,xScaleType:e.scaleTime,debugWebGL:!1,forceWebGL1:!1,legend:!0},f={name:"",color:null,visible:!0,lineType:s.Line,stepLocation:1};function v(t){return t.data=t.data?m._from_array(t.data):new m,Object.setPrototypeOf(t,f),t}let x=class{get options(){return this._options}constructor(t,e){var n,i;this.el=t,this.disposed=!1;const s=function(t,e){const n={series:[],color:getComputedStyle(t).getPropertyValue("color")},i=Object.assign({},n,e);return i.series=i.series.map((t=>v(t))),Object.setPrototypeOf(i,g),i}(t,e);this.model=new p(s);const o=null!==(n=t.shadowRoot)&&void 0!==n?n:t.attachShadow({mode:"open"}),h=document.createElement("style");h.innerText="\n:host {\n    contain: size layout paint style;\n    position: relative;\n}",o.appendChild(h),this.canvasLayer=new a(t,s,this.model),this.svgLayer=new u(t,this.model),this.contentBoxDetector=new r(t,this.model,s),this.nearestPoint=new l(this.canvasLayer,this.model,s,this.contentBoxDetector),this._options=s,this.plugins=Object.fromEntries(Object.entries(null!==(i=null==e?void 0:e.plugins)&&void 0!==i?i:{}).map((([t,e])=>[t,e.apply(this)]))),this.onResize();const d=()=>this.onResize();window.addEventListener("resize",d),this.model.disposing.on((()=>{window.removeEventListener("resize",d),o.removeChild(h)}))}onResize(){this.model.resize(this.el.clientWidth,this.el.clientHeight)}update(){if(this.disposed)throw new Error("Cannot update after dispose.");for(let t=0;t<this.options.series.length;t++){const e=this.options.series[t];f.isPrototypeOf(e)||(this.options.series[t]=v(e))}this.model.requestRedraw()}dispose(){this.model.dispose(),this.disposed=!0}};var y;function w(t){return[{dir:y.X,op:t.x},{dir:y.Y,op:t.y}].filter((t=>void 0!==t.op))}function b(t){const e=t.domain(),n=t.range();return(e[1]-e[0])/(n[1]-n[0])}function P(t,e){const n=e[1]-e[0],i=t.scale.domain();if((i[1]-i[0])*n<=0)return!1;const s=Math.min(t.maxDomainExtent,t.maxDomain-t.minDomain,Math.max(t.minDomainExtent,n)),o=(s-n)/2;e[0]-=o,e[1]+=o;const a=Math.min(Math.max(t.minDomain-e[0],0),t.maxDomain-e[1]);e[0]+=a,e[1]+=a;const r=1e-6*s;return t.scale.domain(e),!!function(...t){return[...t[0]].map(((e,n)=>t.map((t=>t[n]))))}(e,i).some((([t,e])=>Math.abs(t-e)>r))}function E(t,e,n){return t>n?n:t<e?e:t}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.X=1]="X",t[t.Y=2]="Y"}(y||(y={}));class S{constructor(t,e){this.el=t,this.options=e,this.scaleUpdated=new d,this.previousPoint=null;const n=e.eventElement;n.style.userSelect="none",n.addEventListener("pointerdown",(t=>this.onMouseDown(t))),n.addEventListener("pointerup",(t=>this.onMouseUp(t))),n.addEventListener("pointermove",(t=>this.onMouseMove(t)))}point(t){const e=this.el.getBoundingClientRect();return{[y.X]:t.clientX-e.left,[y.Y]:t.clientY-e.top}}onMouseMove(t){if(null===this.previousPoint)return;const e=this.point(t);let n=!1;for(const{dir:t,op:i}of w(this.options)){const s=e[t]-this.previousPoint[t],o=b(i.scale),a=i.scale.domain();P(i,a.map((t=>t-o*s)))&&(n=!0)}this.previousPoint=e,n&&this.scaleUpdated.dispatch()}onMouseDown(t){if("mouse"!==t.pointerType)return;if(0==(t.buttons&this.options.panMouseButtons))return;const e=this.options.eventElement;e.setPointerCapture(t.pointerId),this.previousPoint=this.point(t),e.style.cursor="grabbing"}onMouseUp(t){if(null===this.previousPoint)return;const e=this.options.eventElement;this.previousPoint=null,e.releasePointerCapture(t.pointerId),e.style.cursor=""}}class R{constructor(t,e){this.el=t,this.options=e,this.scaleUpdated=new d,this.majorDirection=y.UNKNOWN,this.previousPoints=new Map,this.enabled={[y.X]:!1,[y.Y]:!1};const n=e.eventElement;n.addEventListener("touchstart",(t=>this.onTouchStart(t)),{passive:!0}),n.addEventListener("touchend",(t=>this.onTouchEnd(t)),{passive:!0}),n.addEventListener("touchcancel",(t=>this.onTouchEnd(t)),{passive:!0}),n.addEventListener("touchmove",(t=>this.onTouchMove(t)),{passive:!0}),this.update()}update(){this.syncEnabled(),this.syncTouchAction()}syncEnabled(){for(const{dir:t,op:e}of w(this.options))if(e){const n=e.scale.domain().sort();this.enabled[t]=e.minDomain<n[0]&&n[1]<e.maxDomain}else this.enabled[t]=!1}syncTouchAction(){const t=[];this.enabled[y.X]||t.push("pan-x"),this.enabled[y.Y]||t.push("pan-y"),0===t.length&&t.push("none"),this.el.style.touchAction=t.join(" ")}calcKB(t,e,n){if(t===this.majorDirection&&n.length>=2){const t=e.scale.domain(),i=t[1]-t[0];if(function(t){const e=t.reduce(((t,e)=>t+e))/t.length;return t.map((t=>(t-e)**2)).reduce(((t,e)=>t+e))/t.length}(n.map((t=>t.domain)))>1e-4*i*i)return function(t){let e=0,n=0,i=0,s=0;const o=t.length;for(const o of t)e+=o.x,n+=o.y,i+=o.x*o.y,s+=o.x*o.x;const a=o*s-e*e,r=0===a?0:(o*i-e*n)/a;return{k:r,b:(n-r*e)/o}}(n.map((t=>({x:t.current,y:t.domain}))))}const i=b(e.scale),s=n.map((t=>t.domain-i*t.current)).reduce(((t,e)=>t+e))/n.length;return{k:i,b:s}}touchPoints(t){if(t.length<this.options.touchMinPoints)return void this.previousPoints.clear();const e=this.el.getBoundingClientRect(),n=new Map([...t].map((t=>[t.identifier,{[y.X]:t.clientX-e.left,[y.Y]:t.clientY-e.top}])));let i=!1;for(const{dir:t,op:e}of w(this.options)){const s=e.scale,o=[...n.entries()].map((([e,n])=>({current:n[t],previousPoint:this.previousPoints.get(e)}))).filter((t=>void 0!==t.previousPoint)).map((({current:e,previousPoint:n})=>({current:e,domain:s.invert(n[t])})));if(0===o.length)continue;const{k:a,b:r}=this.calcKB(t,e,o);P(e,s.range().map((t=>r+a*t)))&&(i=!0)}return this.previousPoints=n,i&&this.scaleUpdated.dispatch(),i}dirOptions(t){return{[y.X]:this.options.x,[y.Y]:this.options.y}[t]}onTouchStart(t){if(this.majorDirection===y.UNKNOWN&&t.touches.length>=2){const e=[...t.touches];function n(t){const e=t.reduce(((t,e)=>t+e))/t.length;return t.map((t=>(t-e)**2)).reduce(((t,e)=>t+e))}const i=n(e.map((t=>t.clientX))),s=n(e.map((t=>t.clientY)));this.majorDirection=i>s?y.X:y.Y,void 0===this.dirOptions(this.majorDirection)&&(this.majorDirection=y.UNKNOWN)}this.touchPoints(t.touches)}onTouchEnd(t){0===t.touches.length&&(this.majorDirection=y.UNKNOWN),this.touchPoints(t.touches)}onTouchMove(t){this.touchPoints(t.touches)}}class T{constructor(t,e){this.el=t,this.options=e,this.scaleUpdated=new d;e.eventElement.addEventListener("wheel",(t=>this.onWheel(t)))}onWheel(t){t.preventDefault();let e=t.deltaX,n=t.deltaY;switch(t.deltaMode){case 1:e*=30,n*=30;break;case 2:e*=400,n*=400}const i={[y.X]:{translate:0,zoom:0},[y.Y]:{translate:0,zoom:0}};t.ctrlKey||t.metaKey?t.altKey?(i[y.X].zoom=e,i[y.Y].zoom=n):i[y.X].zoom=e+n:t.altKey?(i[y.X].translate=e,i[y.Y].translate=n):i[y.X].translate=e+n;const s=this.el.getBoundingClientRect(),o={[y.X]:t.clientX-s.left,[y.Y]:t.clientY-s.top};let a=!1;for(const{dir:e,op:n}of w(this.options)){const s=n.scale.domain(),r=b(n.scale),h=i[e],d=n.scale.invert(o[e]);h.translate*=r,h.zoom*=.002,t.shiftKey&&(h.translate*=5,h.zoom*=5);const l=.4*(s[1]-s[0]);h.translate=E(h.translate,-l,l);const c=.5;h.zoom=E(h.zoom,-c,c);P(n,s.map((t=>t+h.translate+(t-d)*h.zoom)))&&(a=!0)}a&&this.scaleUpdated.dispatch()}}const _={minDomain:-1/0,maxDomain:1/0,minDomainExtent:0,maxDomainExtent:1/0},L={panMouseButtons:7,touchMinPoints:1};class C{constructor(t,e){this.scaleUpdated=new d,e=null!=e?e:{},this.options=new Proxy(e,{get(e,n){var i,s;if("x"===n||"y"===n){const t=e[n];return t?new Proxy(t,{get(t,e){var n;return null!==(n=t[e])&&void 0!==n?n:_[e]}}):t}return"eventElement"===n?null!==(i=e[n])&&void 0!==i?i:t:null!==(s=e[n])&&void 0!==s?s:L[n]}}),this.touch=new R(t,this.options),this.mouse=new S(t,this.options),this.wheel=new T(t,this.options);const n=()=>this.scaleUpdated.dispatch();this.touch.scaleUpdated.on(n),this.mouse.scaleUpdated.on(n),this.wheel.scaleUpdated.on(n)}onScaleUpdated(t){this.scaleUpdated.on(t)}update(){this.touch.update()}}class N{constructor(t,e){this.options=e,this.registerZoom(t)}applyAutoRange(t,e){if(!t)return;if(!t.autoRange)return delete t.minDomain,void delete t.maxDomain;let[n,i]=t.scale.domain();e&&(n=Math.min(n,e.min),i=Math.max(i,e.max)),t.minDomain=n,t.maxDomain=i}registerZoom(t){const e=this.options,n=new C(t.el,e);t.model.updated.on((()=>{this.applyAutoRange(e.x,t.model.xRange),this.applyAutoRange(e.y,t.model.yRange),n.update()})),n.onScaleUpdated((()=>{t.options.xRange=null,t.options.yRange=null,t.options.realTime=!1,t.update()}))}}const M={autoRange:!0};class U{constructor(t){this.options=t}resolveOptions(t){var e;const n=null!==(e=this.options)&&void 0!==e?e:{};return new Proxy(n,{get:(e,n)=>{switch(n){case"x":case"y":const i=e[n];return i?new Proxy(i,{get:(e,i)=>{var s;if("scale"===i)switch(n){case"x":return t.model.xScale;case"y":return t.model.yScale}return null!==(s=e[i])&&void 0!==s?s:M[i]}}):i;case"eventElement":return t.contentBoxDetector.node;default:return e[n]}}})}apply(t){return new N(t,this.resolveOptions(t))}}const D={apply(t){const e=function(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.classList.add("content-box"),n.x.baseVal.value=e.paddingLeft,n.y.baseVal.value=e.paddingRight,t.resized.on(((t,i)=>{n.width.baseVal.value=t-e.paddingRight-e.paddingLeft,n.height.baseVal.value=i-e.paddingTop-e.paddingBottom})),n}(t.model,t.options),n=e.createSVGTransform();n.setTranslate(0,0);const i=document.createElementNS("http://www.w3.org/2000/svg","style");i.textContent="\n.timechart-crosshair {\n    stroke: currentColor;\n    stroke-width: 1;\n    stroke-dasharray: 2 1;\n    visibility: hidden;\n}";const s=document.createElementNS("http://www.w3.org/2000/svg","line");s.transform.baseVal.initialize(n),s.x2.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PERCENTAGE,100);const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.transform.baseVal.initialize(n),o.y2.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PERCENTAGE,100);const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.classList.add("timechart-crosshair");for(const t of[i,s,o])a.appendChild(t);const r=t.contentBoxDetector;r.node.addEventListener("mousemove",(t=>{const n=e.getBoundingClientRect();s.transform.baseVal.getItem(0).setTranslate(0,t.clientY-n.y),o.transform.baseVal.getItem(0).setTranslate(t.clientX-n.x,0)})),r.node.addEventListener("mouseenter",(t=>a.style.visibility="visible")),r.node.addEventListener("mouseleave",(t=>a.style.visibility="hidden")),e.appendChild(a),t.svgLayer.svgNode.appendChild(e)}},k={apply(t){const e=i.select(t.svgLayer.svgNode),s=e.append("g"),o=e.append("g"),a=n.axisBottom(t.model.xScale),r=n.axisLeft(t.model.yScale);function h(){const e=t.model.xScale,n=t.options.xScaleType().domain(e.domain().map((e=>e+t.options.baseTime))).range(e.range());a.scale(n),s.call(a),r.scale(t.model.yScale),o.call(r)}t.model.updated.on(h),t.model.resized.on(((e,n)=>{const i=t.options;s.attr("transform",`translate(0, ${n-i.paddingBottom})`),o.attr("transform",`translate(${i.paddingLeft}, 0)`),h()}))}};class B{constructor(t,e,n){this.el=t,this.model=e,this.options=n,this.items=new Map,this.legend=document.createElement("chart-legend");const i=this.legend.style;i.position="absolute",i.right=`${n.paddingRight}px`,i.top=`${n.paddingTop}px`;const s=this.legend.attachShadow({mode:"open"}),o=document.createElement("style");o.textContent="\n:host {\n    background: var(--background-overlay, white);\n    border: 1px solid hsl(0, 0%, 80%);\n    border-radius: 3px;\n    padding: 5px 10px;\n}\n.item {\n    display: flex;\n    flex-flow: row nowrap;\n    align-items: center;\n    user-select: none;\n}\n.item:not(.visible) {\n    color: gray;\n    text-decoration: line-through;\n}\n.item .example {\n    width: 50px;\n    margin-right: 10px;\n    max-height: 1em;\n}",s.appendChild(o),this.itemContainer=s,this.update();const a=t.shadowRoot;a.appendChild(this.legend),e.updated.on((()=>this.update())),e.disposing.on((()=>{a.removeChild(this.legend)}))}update(){var t,e;if(this.legend.style.display=this.options.legend?"":"none",this.options.legend)for(const n of this.options.series){if(!this.items.has(n)){const t=document.createElement("div");t.className="item";const e=document.createElement("div");e.className="example",t.appendChild(e);const i=document.createElement("label");i.textContent=n.name,t.appendChild(i),this.itemContainer.appendChild(t),t.addEventListener("click",(t=>{n.visible=!n.visible,this.model.update()})),this.items.set(n,{item:t,example:e})}const i=this.items.get(n);i.item.classList.toggle("visible",n.visible),i.example.style.height=`${null!==(t=n.lineWidth)&&void 0!==t?t:this.options.lineWidth}px`,i.example.style.backgroundColor=(null!==(e=n.color)&&void 0!==e?e:this.options.color).toString()}}}const I={apply:t=>new B(t.el,t.model,t.options)};var O,A="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),O=new A(2),A!=Float32Array&&(O[0]=0,O[1]=0);class z{constructor(t,e,n,i){this.gl=t,this.debug=i;const s=F(t.createProgram());t.attachShader(s,F(W(t,t.VERTEX_SHADER,e,i))),t.attachShader(s,F(W(t,t.FRAGMENT_SHADER,n,i))),this.program=s}link(){var t;const e=this.gl,n=this.program;if(e.linkProgram(n),this.debug){if(!e.getProgramParameter(n,e.LINK_STATUS)){const i=null!==(t=e.getProgramInfoLog(n))&&void 0!==t?t:"Unknown Error.";throw e.deleteProgram(n),new Error(i)}}}getUniformLocation(t){return F(this.gl.getUniformLocation(this.program,t))}use(){this.gl.useProgram(this.program)}}function W(t,e,n,i){var s;const o=F(t.createShader(e));if(t.shaderSource(o,n),t.compileShader(o),i){if(!t.getShaderParameter(o,t.COMPILE_STATUS)){const e=null!==(s=t.getShaderInfoLog(o))&&void 0!==s?s:"Unknown Error.";throw t.deleteShader(o),new Error(e)}}return o}function F(t){if(!t)throw new Error("value must not be falsy");return t}const X=256,V=2048,j=524288,G=524286;class Y{constructor(t,e){this.gl=t,this.data=new ArrayBuffer(e),this.ubo=F(t.createBuffer()),t.bindBuffer(t.UNIFORM_BUFFER,this.ubo),t.bufferData(t.UNIFORM_BUFFER,this.data,t.DYNAMIC_DRAW)}get modelScale(){return new Float32Array(this.data,0,2)}get modelTranslate(){return new Float32Array(this.data,8,2)}get projectionScale(){return new Float32Array(this.data,16,2)}upload(t=0){this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,t,this.ubo),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,0,this.data)}}const $="#version 300 es\nlayout (std140) uniform proj {\n    vec2 modelScale;\n    vec2 modelTranslate;\n    vec2 projectionScale;\n};\nuniform highp sampler2D uDataPoints;\nuniform int uLineType;\nuniform float uStepLocation;\n\nconst int TEX_WIDTH = 256;\nconst int TEX_HEIGHT = 2048;\n\nvec2 dataPoint(int index) {\n    int x = index % TEX_WIDTH;\n    int y = index / TEX_WIDTH;\n    return texelFetch(uDataPoints, ivec2(x, y), 0).xy;\n}\n",H="#version 300 es\nprecision lowp float;\nuniform vec4 uColor;\nout vec4 outColor;\nvoid main() {\n    outColor = uColor;\n}";class K extends z{constructor(t,e){super(t,K.VS_SOURCE,H,e),this.link(),this.locations={uDataPoints:this.getUniformLocation("uDataPoints"),uPointSize:this.getUniformLocation("uPointSize"),uColor:this.getUniformLocation("uColor")},this.use(),t.uniform1i(this.locations.uDataPoints,0);const n=t.getUniformBlockIndex(this.program,"proj");t.uniformBlockBinding(this.program,n,0)}}K.VS_SOURCE=`${$}\nuniform float uPointSize;\n\nvoid main() {\n    vec2 pos2d = projectionScale * modelScale * (dataPoint(gl_VertexID) + modelTranslate);\n    gl_Position = vec4(pos2d, 0, 1);\n    gl_PointSize = uPointSize;\n}\n`;class q extends z{constructor(t,e){super(t,q.VS_SOURCE,H,e),this.link(),this.locations={uDataPoints:this.getUniformLocation("uDataPoints"),uLineType:this.getUniformLocation("uLineType"),uStepLocation:this.getUniformLocation("uStepLocation"),uLineWidth:this.getUniformLocation("uLineWidth"),uColor:this.getUniformLocation("uColor")},this.use(),t.uniform1i(this.locations.uDataPoints,0);const n=t.getUniformBlockIndex(this.program,"proj");t.uniformBlockBinding(this.program,n,0)}}q.VS_SOURCE=`${$}\nuniform float uLineWidth;\n\nvoid main() {\n    int side = gl_VertexID & 1;\n    int di = (gl_VertexID >> 1) & 1;\n    int index = gl_VertexID >> 2;\n\n    vec2 dp[2] = vec2[2](dataPoint(index), dataPoint(index + 1));\n\n    vec2 base;\n    vec2 off;\n    if (uLineType == ${s.Line}) {\n        base = dp[di];\n        vec2 dir = dp[1] - dp[0];\n        dir = normalize(modelScale * dir);\n        off = vec2(-dir.y, dir.x) * uLineWidth;\n    } else if (uLineType == ${s.Step}) {\n        base = vec2(dp[0].x * (1. - uStepLocation) + dp[1].x * uStepLocation, dp[di].y);\n        float up = sign(dp[0].y - dp[1].y);\n        off = vec2(uLineWidth * up, uLineWidth);\n    }\n\n    if (side == 1)\n        off = -off;\n    vec2 cssPose = modelScale * (base + modelTranslate);\n    vec2 pos2d = projectionScale * (cssPose + off);\n    gl_Position = vec4(pos2d, 0, 1);\n}`;class Z{constructor(t,e){this.gl=t,this.dataPoints=e,this.dataBuffer=F(t.createTexture()),t.bindTexture(t.TEXTURE_2D,this.dataBuffer),t.texStorage2D(t.TEXTURE_2D,1,t.RG32F,X,V),t.texSubImage2D(t.TEXTURE_2D,0,0,0,X,V,t.RG,t.FLOAT,new Float32Array(1048576)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)}delete(){this.gl.deleteTexture(this.dataBuffer)}syncPoints(t,e,n){const i=this.dataPoints;let s=Math.floor(n/X),o=Math.ceil((n+e)/X);s>0&&0===t&&n===s*X&&s--,o<V&&t+e===i.length&&n+e===o*X&&o++;const a=new Float32Array((o-s)*X*2);for(let e=s;e<o;e++)for(let o=0;o<X;o++){const r=e*X+o,h=i[Math.max(Math.min(t+r-n,i.length-1),0)],d=2*((e-s)*X+o);a[d]=h.x,a[d+1]=h.y}const r=this.gl;r.bindTexture(r.TEXTURE_2D,this.dataBuffer),r.texSubImage2D(r.TEXTURE_2D,0,0,s,X,o-s,r.RG,r.FLOAT,a)}draw(t,e){const n=Math.max(0,t.start),i=Math.min(G,t.end),o=i-n,a=this.gl;if(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.dataBuffer),e===s.Line)a.drawArrays(a.TRIANGLE_STRIP,4*n,4*o+(i!==t.end?2:0));else if(e===s.Step){let e=4*n,i=4*o+2;n===t.start&&(e-=2,i+=2),a.drawArrays(a.TRIANGLE_STRIP,e,i)}else e===s.NativeLine?a.drawArrays(a.LINE_STRIP,n,o+1):e===s.NativePoint&&a.drawArrays(a.POINTS,n,o+1)}}class J{constructor(t,e){this.gl=t,this.series=e,this.segments=[],this.validStart=0,this.validEnd=0}popFront(){if(0!==this.series.data.poped_front){for(this.validStart+=this.series.data.poped_front;this.validStart>G;){this.segments[0].delete(),this.segments.shift(),this.validStart-=G}this.segments[0].syncPoints(0,0,this.validStart)}}popBack(){if(0!==this.series.data.poped_back){for(this.validEnd-=this.series.data.poped_back;this.validEnd<2;){this.segments[this.segments.length-1].delete(),this.segments.pop(),this.validEnd+=G}this.segments[this.segments.length-1].syncPoints(this.series.data.length,0,this.validEnd)}}newArray(){return new Z(this.gl,this.series.data)}pushFront(){let t=this.series.data.pushed_front;if(0===t)return;const e=()=>{this.segments.unshift(this.newArray()),this.validStart=j};for(0===this.segments.length&&(e(),this.validEnd=this.validStart=524287);;){const n=this.segments[0],i=Math.min(this.validStart,t);if(n.syncPoints(t-i,i,this.validStart-i),t-=this.validStart-2,this.validStart-=i,this.validStart>0)break;e()}}pushBack(){let t=this.series.data.pushed_back;if(0===t)return;const e=()=>{this.segments.push(this.newArray()),this.validEnd=0};for(0===this.segments.length&&(e(),this.validEnd=this.validStart=1);;){const n=this.segments[this.segments.length-1],i=Math.min(j-this.validEnd,t);if(n.syncPoints(this.series.data.length-t,i,this.validEnd),t-=G-this.validEnd,this.validEnd+=i,this.validEnd<j)break;e()}}deinit(){for(const t of this.segments)t.delete();this.segments=[]}syncBuffer(){const t=this.series.data;t.length-t.pushed_back-t.pushed_front<2&&(this.deinit(),t.poped_front=t.poped_back=0),0!==this.segments.length?(this.popFront(),this.popBack(),this.pushFront(),this.pushBack()):t.length>=2&&(t.pushed_back>t.pushed_front?(t.pushed_back=t.length,this.pushBack()):(t.pushed_front=t.length,this.pushFront()))}draw(t){const e=this.series.data;if(0===this.segments.length||e[0].x>t.max||e[e.length-1].x<t.min)return;const n=t=>t.x,i=h(e,1,e.length,t.min,n)-1,s=h(e,i,e.length-1,t.max,n),o=i+this.validStart,a=s+this.validStart,r=Math.floor(o/G),d=Math.ceil(a/G);for(let t=r;t<d;t++){const e=t*G;this.segments[t].draw({start:o-e,end:a-e},this.series.lineType)}}}class Q{constructor(t,e,n){this.model=t,this.gl=e,this.options=n,this.lineProgram=new q(this.gl,this.options.debugWebGL),this.nativeLineProgram=new K(this.gl,this.options.debugWebGL),this.arrays=new Map,this.height=0,this.width=0,this.renderHeight=0,this.renderWidth=0;const i=e.getActiveUniformBlockParameter(this.lineProgram.program,0,e.UNIFORM_BLOCK_DATA_SIZE);this.uniformBuffer=new Y(this.gl,i),t.updated.on((()=>this.drawFrame())),t.resized.on(((t,e)=>this.onResize(t,e)))}syncBuffer(){for(const t of this.options.series){let e=this.arrays.get(t);e||(e=new J(this.gl,t),this.arrays.set(t,e)),e.syncBuffer()}}syncViewport(){this.renderWidth=this.width-this.options.renderPaddingLeft-this.options.renderPaddingRight,this.renderHeight=this.height-this.options.renderPaddingTop-this.options.renderPaddingBottom;const t=function(t,e){var n=new A(2);return n[0]=t,n[1]=e,n}(this.renderWidth,this.renderHeight);!function(t,e,n){t[0]=e[0]/n[0],t[1]=e[1]/n[1]}(t,[2,2],t),this.uniformBuffer.projectionScale.set(t)}onResize(t,e){this.height=e,this.width=t}drawFrame(){var t,e;this.syncBuffer(),this.syncDomain(),this.uniformBuffer.upload();const n=this.gl;for(const[i,a]of this.arrays){if(!i.visible)continue;const r=i.lineType===s.NativeLine||i.lineType===s.NativePoint?this.nativeLineProgram:this.lineProgram;r.use();const h=o(null!==(t=i.color)&&void 0!==t?t:this.options.color);n.uniform4fv(r.locations.uColor,h);const d=null!==(e=i.lineWidth)&&void 0!==e?e:this.options.lineWidth;r instanceof q?(n.uniform1i(r.locations.uLineType,i.lineType),n.uniform1f(r.locations.uLineWidth,d/2),i.lineType===s.Step&&n.uniform1f(r.locations.uStepLocation,i.stepLocation)):i.lineType===s.NativeLine?n.lineWidth(d*this.options.pixelRatio):i.lineType===s.NativePoint&&n.uniform1f(r.locations.uPointSize,d*this.options.pixelRatio);const l={min:this.model.xScale.invert(this.options.renderPaddingLeft-d/2),max:this.model.xScale.invert(this.width-this.options.renderPaddingRight+d/2)};a.draw(l)}if(this.options.debugWebGL){const t=n.getError();if(t!=n.NO_ERROR)throw new Error(`WebGL error ${t}`)}}syncDomain(){this.syncViewport();const t=this.model,e=t.xScale.domain(),n=t.xScale.range(),i=t.yScale.domain(),s=t.yScale.range(),o=[(n[1]-n[0])/(e[1]-e[0]),(s[0]-s[1])/(i[1]-i[0])],a=[(n[0]-this.renderWidth/2-this.options.renderPaddingLeft)/o[0]-e[0],-(s[0]-this.renderHeight/2-this.options.renderPaddingTop)/o[1]-i[0]];this.uniformBuffer.modelScale.set(o),this.uniformBuffer.modelTranslate.set(a)}}const tt={apply:t=>new Q(t.model,t.canvasLayer.gl,t.options)};class et{constructor(t,e,n,i){this.svg=t,this.options=e,this.model=n,this.pModel=i,this.intersectPoints=new Map;t.svgNode.createSVGTransform().setTranslate(0,0);const s=document.createElementNS("http://www.w3.org/2000/svg","style");s.textContent="\n.timechart-crosshair-intersect {\n    fill: var(--background-overlay, white);\n    visibility: hidden;\n}\n.timechart-crosshair-intersect circle {\n    r: 3px;\n}";const o=document.createElementNS("http://www.w3.org/2000/svg","g");o.classList.add("timechart-crosshair-intersect"),o.appendChild(s),this.container=o,this.adjustIntersectPoints(),t.svgNode.appendChild(o),i.updated.on((()=>this.adjustIntersectPoints()))}adjustIntersectPoints(){var t,e;const n=this.svg.svgNode.createSVGTransform();n.setTranslate(0,0);for(const i of this.options.series){if(!this.intersectPoints.has(i)){const t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.transform.baseVal.initialize(n),this.container.appendChild(t),this.intersectPoints.set(i,t)}const s=this.intersectPoints.get(i);s.style.stroke=(null!==(t=i.color)&&void 0!==t?t:this.options.color).toString(),s.style.strokeWidth=`${null!==(e=i.lineWidth)&&void 0!==e?e:this.options.lineWidth}px`;const o=this.pModel.dataPoints.get(i);if(o){s.style.visibility="visible";const t=this.model.pxPoint(o);s.transform.baseVal.getItem(0).setTranslate(t.x,t.y)}else s.style.visibility="hidden"}}}const nt={apply:t=>new et(t.svgLayer,t.options,t.model,t.nearestPoint)};class it{constructor(t,e){this.options=e,this.items=new Map,this.chartOptions=t.options;this.tooltip=document.createElement("chart-tooltip");const n=this.tooltip.style;n.position="absolute",n.visibility="hidden";const i=this.tooltip.attachShadow({mode:"open"}),s=document.createElement("style");s.textContent="\n:host {\n    background: var(--background-overlay, white);\n    border: 1px solid hsl(0, 0%, 80%);\n    border-radius: 3px;\n    padding: 2px 2px;\n}\n.item {\n    user-select: none;\n}\n.out-of-range.item {\n    display: none;\n}\ntd {\n    padding: 0px 5px;\n}\n.name {\n    margin-right: 10px;\n    max-width: 100px;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n}\n.example {\n    width: 6px;\n    height: 6px;\n}\n.value {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    min-width: 100px;\n    max-width: 100px;\n    text-align: right;\n}\n.x-not-aligned .value {\n    opacity: 0.4;\n}\n",i.appendChild(s);const o=document.createElement("table");this.xItem=this.createItemElements(this.options.xLabel),o.appendChild(this.xItem.item),i.appendChild(o),this.itemContainer=o,this.update(),t.el.shadowRoot.appendChild(this.tooltip),t.model.updated.on((()=>this.update())),t.model.disposing.on((()=>{t.el.shadowRoot.removeChild(this.tooltip)})),t.nearestPoint.updated.on((()=>{if(!e.enabled||0==t.nearestPoint.dataPoints.size)return void(n.visibility="hidden");n.visibility="visible";const i=t.nearestPoint.lastPointerPos,s=this.tooltip.getBoundingClientRect();let o=i.x-s.width-12,a=i.y-s.height-12;o<0&&(o=i.x+12),a<0&&(a=i.y+12),n.left=o+"px",n.top=a+"px";let r=Number.POSITIVE_INFINITY,h=null;for(const[e,n]of t.nearestPoint.dataPoints){const e=t.model.pxPoint(n),s=e.x-i.x,o=e.y-i.y,a=Math.sqrt(s*s+o*o);a<r&&(r=a,h=n.x)}const d=e.xFormatter;this.xItem.value.textContent=d(h);for(const e of t.options.series){if(!e.visible)continue;let n=t.nearestPoint.dataPoints.get(e),i=this.items.get(e);i&&(i.item.classList.toggle("out-of-range",!n),n&&(i.value.textContent=n.y.toLocaleString(),i.item.classList.toggle("x-not-aligned",n.x!==h)))}}))}createItemElements(t){const e=document.createElement("tr");e.className="item";const n=document.createElement("td"),i=document.createElement("div");i.className="example",n.appendChild(i),e.appendChild(n);const s=document.createElement("td");s.className="name",s.textContent=t,e.appendChild(s);const o=document.createElement("td");return o.className="value",e.appendChild(o),{item:e,example:i,name:s,value:o}}update(){var t;for(const e of this.chartOptions.series){if(!this.items.has(e)){const t=this.createItemElements(e.name);this.itemContainer.appendChild(t.item),this.items.set(e,t)}const n=this.items.get(e);n.example.style.backgroundColor=(null!==(t=e.color)&&void 0!==t?t:this.chartOptions.color).toString(),n.item.style.display=e.visible?"":"none"}}}const st={enabled:!1,xLabel:"X",xFormatter:t=>t.toLocaleString()};class ot{constructor(t){t||(t={}),st.isPrototypeOf(t)||Object.setPrototypeOf(t,st),this.options=t}apply(t){return new it(t,this.options)}}class at extends x{get options(){return this._options}constructor(t,e){super(t,function(t){var e;const n=null!=t?t:{plugins:void 0,zoom:void 0,tooltip:void 0};return Object.assign(Object.assign({},t),{plugins:Object.assign({lineChart:tt,d3Axis:k,crosshair:D,nearestPoint:nt,legend:I,zoom:new U(n.zoom),tooltip:new ot(n.tooltip)},null!==(e=n.plugins)&&void 0!==e?e:{})})}(e)),this.el=t}}return at.core=x,at.plugins={lineChart:tt,d3Axis:k,crosshair:D,nearestPoint:nt,legend:I,TimeChartZoomPlugin:U,TimeChartTooltipPlugin:ot},at.LineType=s,at}(d3,d3,d3,d3);
//# sourceMappingURL=timechart.min.js.map
